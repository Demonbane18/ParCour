function spController(){return{async index(e,r){const i=e.session.service_provideradded;e.session.service_provideradded=null;const d=await ServiceProvider.find({});return r.render("admin/service_providers",{service_providers:d,service_providerAdded:i})},addServiceProvider:(e,r)=>r.render("admin/add_service_provider"),async store(e,r){const{name:i,address:d}=e.body;if(!i||!d)return e.flash("error","All fields are required!"),e.flash("name",i),e.flash("address",d),r.redirect("/admin/add_service_provider");ServiceProvider.exists({name:i},(s,o)=>{if(o)return e.flash("error","Service Provider already exists"),e.flash("name",i),e.flash("address",d),r.redirect("/service_provider/add_service_provider")});const s=new ServiceProvider({name:i,address:d});s.save().then(i=>(e.session.service_provideradded=!0,r.redirect("/admin/service_providers"))).catch(i=>(e.flash("error","Something went wrong!"),r.redirect("/admin/add_service_provider")))},editServiceProvider(e,r){const i=e.session.service_provideredited;e.session.service_provideredited=null,ServiceProvider.findById(e.params.id,(e,d)=>{if(e)return console.log(e);r.render("admin/edit_service_provider",{id:d._id,name:d.name,address:d.address,service_providerEdited:i})})},async edit(e,r){var i=e.params.id;const{name:d,address:s}=e.body;if(!d||!s)return e.flash("error","All fields are required!"),e.flash("name",d),e.flash("address",s),r.redirect("/admin/edit_service_provider/"+i);ServiceProvider.exists({_id:{$ne:i},name:d},(o,n)=>{if(n)return e.flash("error","You cannot edit a Service Provider of the same name"),e.flash("address",image),r.redirect("/admin/edit_service_provider/"+i);ServiceProvider.findById(i,(r,i)=>{if(r)return console.log(r);i.name=d,i.address=s,i.save(r=>{if(r)return console.log(r);ServiceProvider.find(function(r,i){r?console.log(r):e.app.locals.service_providers=i})})}).then(d=>(e.flash("success","ServiceProvider edited!"),e.session.service_provideredited=!0,r.redirect("/admin/edit_service_provider/"+i))).catch(d=>(e.flash("error","Something went wrong!"),r.redirect("/admin/edit_service_provider/"+i)))})},delete(e,r){ServiceProvider.findByIdAndRemove(e.params.id,i=>{if(i)return console.log(i);ServiceProvider.find((r,i)=>{r?console.log(r):e.app.locals.service_providers=i}),r.redirect("/admin/service_providers/")})}}}const ServiceProvider=require("../../../models/service_provider"),Swal=require("sweetalert2");module.exports=spController;