function orderController(){return{store(e,r){const{phone:i,service_provider:t,pickup_address:s,dropoff_address:a,item_name:m,item_qty:o,perishable:n,item_weight:d,item_name2:p,item_qty2:_,perishable2:c,item_weight2:l,item_name3:h,item_qty3:u,perishable3:g,item_weight3:y,item_name4:b,item_qty4:w,perishable4:f,item_weight4:q,item_name5:k,item_qty5:v,perishable5:O,item_weight5:C}=e.body;if(!(i&&s&&a&&m&&d))return e.flash("error","All fields required!"),r.redirect("/parcel");const x={item_name:m,item_qty:o,perishable_check:n?"perishable":"no",item_weight:d},S={item_name:p,item_qty:_,perishable_check:c?"perishable":"no",item_weight:l},A={item_name:h,item_qty:u,perishable_check:g?"perishable":"no",item_weight:y},B={item_name:b,item_qty:w,perishable_check:f?"perishable":"no",item_weight:q},P={item_name:k,item_qty:v,perishable_check:O?"perishable":"no",item_weight:C},j={item1:x,item2:S,item3:A,item4:B,item5:P},D=new Order({tracking_id:id,service_provider:t,supplier_id:e.user._id,name:e.user.name,company_name:e.user.company_name,items:e.session.order.info,parcelDetails:j,phone:i,pickup_address:s,dropoff_address:a});D.save().then(i=>{Order.populate(i,{path:"supplier_id"},(i,t)=>{e.flash("success","Parcel booked successfully"),delete e.session.order;const s=e.app.get("eventEmitter");return s.emit("parcelBooked",t),r.redirect("/supplier/orders")})}).catch(i=>(e.flash("error","Something went wrong"),r.redirect("/parcel")))},async index(e,r){const i=await Order.find({supplier_id:e.user._id},null,{sort:{createdAt:-1}});r.header("Cache-Control","no-cache, private, no-store, must-revalidate, max-stale=0, post-check=0, pre-check=0"),r.render("supplier/orders.ejs",{orders:i,moment:moment})},async show(e,r){const i=await Order.findById(e.params._id);e.user._id.toString()===i.supplier_id.toString()?r.render("supplier/singleParcel",{order:i}):r.redirect("/")}}}const Order=require("../../../models/order"),moment=require("moment"),orderid=require("order-id")("mysecret"),id=orderid.generate();module.exports=orderController;