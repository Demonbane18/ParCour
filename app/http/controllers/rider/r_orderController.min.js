function r_orderController(){return{index(e,r){const d=e.session.ordersearched,s=e.session.term_order;if(e.session.term_order=null,d)return orders=d,e.xhr?r.json(orders):r.render("rider/orders",{term_order:s});order.find({status:{$nin:["delivered","cancelled"]},service_provider:e.user.company_name,delivered_by:e.user.name},null,{sort:{createdAt:-1}}).populate("supplier_id","-password").exec((d,s)=>e.xhr?r.json(s):(e.session.ordersearched=null,r.render("rider/orders",{term_order:null})))},async searchOrder(e,r){const{term_order:d}=e.body;if(!d)return e.session.ordersearched=null,r.redirect("/rider/orders");await order.find({$text:{$search:d},service_provider:e.user.company_name,delivered_by:e.user.name,status:{$nin:["completed","cancelled"]}},{score:{$meta:"textScore"}},(d,s)=>d?(e.flash("error","Error! Something went wrong"),r.redirect("/rider/orders")):s.length?void 0:(e.flash("error","no text"),e.session.ordersearched=null,e.session.term_order=null,r.redirect("/rider/orders"))).sort({score:{$meta:"textScore"}}).populate("supplier_id","-password").exec((s,o)=>s?(e.flash("error","Error! Something went wrong"),r.redirect("/rider/orders")):(e.session.ordersearched=o,e.session.term_order=d,r.redirect("/rider/orders")))},complete(e,r){order.find({status:{$eq:"delivered"},service_provider:e.user.company_name,delivered_by:e.user.name},null,{sort:{createdAt:-1}}).populate("supplier_id","-password").exec((d,s)=>e.xhr?r.json(s):r.render("rider/completed_orders"))},cancel(e,r){order.find({status:{$eq:"cancelled"},service_provider:e.user.company_name,delivered_by:e.user.name},null,{sort:{createdAt:-1}}).populate("supplier_id","-password").exec((d,s)=>e.xhr?r.json(s):r.render("rider/cancelled_orders"))}}}const order=require("../../../models/order"),Order=require("../../../models/order"),Rider=require("../../../models/rider"),User=require("../../../models/user");module.exports=r_orderController;