function profileController(){return{async index(e,r){try{const o=e.session.profileedited;e.session.profileedited=null;const i=await User.findById(e.user._id);r.render("profile",{name:i.name,email:i.email,phone:i.phone,address:i.address,is_verified:i.is_verified,profileEdited:o})}catch(e){console.log(e.message)}},async editProfile(e,r){const{name:o,phone:i,address:s}=e.body,n=e.user._id;if(!o||!i||!s)return e.flash("error","All fields are required!"),r.redirect("/profile");const d=dupeChecker.nameCheck(n,o);console.log(d);const l=dupeChecker.phoneCheck(n,i);if(1==d)return e.flash("error","Name already taken!"),r.redirect("/profile");if(1==l)return e.flash("error","Phone already taken!"),r.redirect("/profile");const t=await User.findByIdAndUpdate({_id:n},{$set:{name:o,phone:i,address:s}});return t?(e.session.profileedited=!0,r.redirect("/profile")):(console.log(err.message),e.flash("error","Something went wrong!"),r.redirect("/profile"))}}}const User=require("../../models/user"),dupeChecker=require("../../config/dupeChecker");module.exports=profileController;