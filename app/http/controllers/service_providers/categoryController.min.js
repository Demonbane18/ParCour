function categoryController(){return{async index(e,r){const i=e.session.categoryadded;e.session.categoryadded=null;const a=e.user.company_name,c=await Parcel.find({service_provider:a});return r.render("service_provider/category",{parcels:c,categoryAdded:i})},addCategory:(e,r)=>r.render("service_provider/add_category"),async store(e,r){const{vehicle_type:i,image:a,weight:c,price:t}=e.body;if(!(i&&a&&c&&t))return e.flash("error","All fields are required!"),e.flash("vehicle_type",i),e.flash("image",a),e.flash("weight",c),e.flash("price",t),r.redirect("/service_provider/add_category");Parcel.exists({vehicle_type:i},(i,o)=>{if(o)return e.flash("error","Vehicle type already exists"),e.flash("image",a),e.flash("weight",c),e.flash("price",t),r.redirect("/service_provider/add_category")});const o=new Parcel({vehicle_type:i,service_provider:e.user.company_name,image:a,weight:c,price:t});o.save().then(i=>(e.session.categoryadded=!0,r.redirect("/service_provider/category"))).catch(i=>(e.flash("error","Something went wrong!"),r.redirect("/service_provider/add_category")))},editCategory(e,r){const i=e.session.categoryedited;e.session.categoryedited=null,Parcel.findById(e.params.id,(e,a)=>{if(e)return console.log(e);r.render("service_provider/edit_category",{id:a._id,vehicle_type:a.vehicle_type,image:a.image,weight:a.weight,price:a.price,categoryEdited:i})})},async edit(e,r){var i=e.params.id;const{vehicle_type:a,image:c,weight:t,price:o}=e.body;if(!(a&&c&&t&&o))return e.flash("error","All fields are required!"),e.flash("vehicle_type",a),e.flash("image",c),e.flash("weight",t),e.flash("price",o),r.redirect("/service_provider/edit_category/"+i);Parcel.exists({_id:{$ne:i},vehicle_type:a},(s,d)=>{if(d)return e.flash("error","You cannot edit a vehicle type of another category!"),e.flash("image",c),e.flash("weight",t),e.flash("price",o),r.redirect("/service_provider/edit_category/"+i);Parcel.findById(i,(r,i)=>{if(r)return console.log(r);i.vehicle_type=a,i.image=c,i.weight=t,i.price=o,i.save(r=>{if(r)return console.log(r);Parcel.find(function(r,i){r?console.log(r):e.app.locals.parcels=i})})}).then(a=>(e.flash("success","Category edited!"),e.session.categoryedited=!0,r.redirect("/service_provider/edit_category/"+i))).catch(a=>(e.flash("error","Something went wrong!"),r.redirect("/service_provider/edit_category/"+i)))})},delete(e,r){Parcel.findByIdAndRemove(e.params.id,i=>{if(i)return console.log(i);Parcel.find((r,i)=>{r?console.log(r):e.app.locals.parcels=i}),r.redirect("/service_provider/category/")})}}}const Parcel=require("../../../models/parcel"),Swal=require("sweetalert2");module.exports=categoryController;