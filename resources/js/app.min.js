import axios from"axios";import Noty from"noty";import moment from"moment";import{initSP}from"./service_provider";import{initR}from"./rider";console.log("hello from app.js"),document.addEventListener("DOMContentLoaded",()=>{function e(e){axios.post("/update-parcel",e).then(e=>{console.log(e),n.innerText=e.data.total_qty,new Noty({type:"success",timeout:3e3,progressBar:!1,text:"New parcel added to orders",afterClose:setTimeout(window.location.href="/parcel",5e3)}).show()}).catch(e=>{new Noty({type:"error",timeout:3e3,progressBar:!1,text:"Something went wrong"}).show()})}function t(e){l.forEach(e=>{e.classList.remove("step-completed"),e.classList.remove("current")});let t=!0;l.forEach(o=>{let r=o.dataset.status;t&&o.classList.add("step-completed"),r===e.status&&(t=!1,i.innerText=moment(e.updatedAt).format("ddd MMM Do, hh:mm A"),o.appendChild(i),o.nextElementSibling&&o.nextElementSibling.classList.add("current"))})}function o(e){Swal.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it"}).then(t=>{t.isConfirmed&&(Swal.fire({timer:1e3,showConfirmButton:!1,title:"Category Deleted",text:"This category has been successfully deleted!",type:"success",icon:"success"}),setTimeout(()=>{document.location.href="/service_provider/delete_category/"+e._id},1500))})}let r=document.querySelectorAll("#add-to-parcel"),n=document.querySelector("#parcelCounter");r.forEach(t=>{t.addEventListener("click",o=>{let r=JSON.parse(t.dataset.parcel);e(r)})});const s=document.querySelector("#success-alert");s&&setTimeout(()=>{s.remove()},2e3);let l=document.querySelectorAll(".status_line"),a=document.querySelector("#hiddenInput"),c=a?a.value:null;c=JSON.parse(c);let i=document.createElement("small");t(c);let d=io();initSP(d),initR(d),c&&d.emit("join",`order_${c._id}`);let u=window.location.pathname;console.log(u),u.includes("service_provider")&&d.emit("join","spRoom"),u.includes("rider")&&d.emit("join","rRoom"),d.on("parcelUpdated",e=>{const o={...c};o.updatedAt=moment().format(),o.status=e.status,t(o),new Noty({type:"success",timeout:1e3,progressBar:!1,text:"Parcel updated",progressBar:!1}).show()});let m=document.querySelectorAll("#deleteCategory");m.forEach(e=>{e.addEventListener("click",t=>{let r=JSON.parse(e.dataset.delete);console.log(r),o(r)})});const p=document.getElementById("track");p.addEventListener("keydown",e=>{"Backspace"!==e.key&&"Delete"!==e.key&&(4===e.target.value.length&&(p.value=p.value+"-"),11===e.target.value.length&&(p.value=p.value+"-"))})});